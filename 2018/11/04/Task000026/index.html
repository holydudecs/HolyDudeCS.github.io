<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="c/c++代写,java代写,python代写,matlab代写,作业代写,留学生作业代写" />





  <link rel="alternate" href="/atom.xml" title="中国留学生CS作业代写" type="application/atom+xml" />






<meta name="description" content="c/c++代写,java代写,python代写,matlab代写,作业代写,留学生作业代写  Introduction  The objective of this assignment is to implement a tiny-UNIX with 3 services: read, write, and exit on the SAPC. The students are asked to">
<meta name="keywords" content="c&#x2F;c++代写,java代写,python代写,matlab代写,作业代写,留学生作业代写">
<meta property="og:type" content="article">
<meta property="og:title" content="HW2 Tiny-UNIX on the SAPC">
<meta property="og:url" content="http://holydudecs.github.io/2018/11/04/Task000026/index.html">
<meta property="og:site_name" content="中国留学生CS作业代写">
<meta property="og:description" content="c/c++代写,java代写,python代写,matlab代写,作业代写,留学生作业代写  Introduction  The objective of this assignment is to implement a tiny-UNIX with 3 services: read, write, and exit on the SAPC. The students are asked to">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://holydudecs.github.io/2018/11/04/Task000026/images/wechat.jpeg">
<meta property="og:updated_time" content="2018-11-04T13:11:13.343Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HW2 Tiny-UNIX on the SAPC">
<meta name="twitter:description" content="c/c++代写,java代写,python代写,matlab代写,作业代写,留学生作业代写  Introduction  The objective of this assignment is to implement a tiny-UNIX with 3 services: read, write, and exit on the SAPC. The students are asked to">
<meta name="twitter:image" content="http://holydudecs.github.io/2018/11/04/Task000026/images/wechat.jpeg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://holydudecs.github.io/2018/11/04/Task000026/"/>





  <title>HW2 Tiny-UNIX on the SAPC | 中国留学生CS作业代写</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">中国留学生CS作业代写</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://holydudecs.github.io/2018/11/04/Task000026/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless Coder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wechat.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="中国留学生CS作业代写">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">HW2 Tiny-UNIX on the SAPC</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-04T19:23:10+08:00">
                2018-11-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <a id="more"></a>
<p>c/c++代写,java代写,python代写,matlab代写,作业代写,留学生作业代写</p>
<ol>
<li>Introduction</li>
</ol>
<p>The objective of this assignment is to implement a tiny-UNIX with 3 services: read, write, and exit on the SAPC. The students are asked to convert the read, write functions in hw1’s I/O package to system calls. In addition, they are asked to write the new service exit. The prototypes for the services are:</p>
<p>int read(int dev, char <em>buf, int nchar);    /</em> read nchar bytes into buf from dev <em>/<br>int write(int dev, char </em>buf, int nchar); /<em> write nchar bytes from buf to dev </em>/</p>
<p>int exit(int exitcode);                        /<em> exit will return back to Tutor </em>/</p>
<p>The testio program in hw1 can be modified to test the 3 services. Use a script file to capture the outputs.</p>
<ol start="2">
<li>Discussions</li>
</ol>
<p>This assignment builds on your standalone I/O package from hw1.  If you prefer, you can use the hw1 solution, which is included in the provided hw2 directory.  In any case, fix yours, if necessary, up to spec first.</p>
<p>To make system calls, the user program needs to execute a trap instruction to transfer control to the kernel and the kernel’s trap handler will perform the service. The x86 Linux syscall linkage is as follows:</p>
<p>–int 0x80 is the syscall instruction</p>
<p>–the syscall # is in eax</p>
<p>–the syscall args are in ebx (first), ecx (second), and edx (third).</p>
<p>Here are the files you need:</p>
<p>i) Shared between user and kernel:</p>
<p>   tty_public.h: device numbers</p>
<p>   tsyscall.h: syscall numbers (like the UNIX /usr/include/sys/syscall.h)</p>
<p>ii) Kernel files:</p>
<p>   ioconf.h, tty.h: i/o headers used only by kernel</p>
<p>   tsystm.h: syscall dispatch, kernel fn protos (like UNIX /usr/include/sys/systm.h)</p>
<p>   startup0.s: same as $pclibsrc/startup0.s.  Sets up stack, calls  into startup1.c</p>
<p>   startup1.c: same as $pclibsrc/startup.c, but calls your kernel initialization routine instead of main.</p>
<p>   tunix.c:  has kernel init routine. It needs to call ioinit, call set_trap_gate(0x80,&amp;syscall), and </p>
<pre><code>             possibly other inits. tunix.c also has the code for syscallc, sys call exit, and set_trap_gate. The

             code for set_trap_gate is just that of set_intr_gate with the line:


               desc-&gt;flags = GATE_P|GATE_DPL_KERNEL|GATE_INTGATE;

            Replaced by

              desc-&gt;flags = GATE_P|GATE_DPL_KERNEL|GATE_TRAPGATE;


   You can find the locate_idt function in $pclibsrc/cpureg.S. Make sure you include the following prototype if you want to call it using C:



          extern void locate_idt(unsigned int *limitp, char ** idtp);


syscallc: first write it with a big switch statement over the various different syscalls.  If you have time,

              upgrade it to use a sysent dispatch table.
</code></pre><p>   sysentry.s:  Trap handler’s assembler envelope routine _syscall for the trap resulting from a</p>
<pre><code>system call--needs to push eax, ebx, ecx, edx on stack, where they can be accessed from C,

call _syscallc, then pops, iret. Use $pclibsrc/irq4.s as an example and modify it to fit your

needs.
</code></pre><p>   io.c: rename “read” to “sysread”, etc. to avoid linking problems, since “read” is a now user-level call.</p>
<p>   ioconf.c, ioconf.h:  from hw1.</p>
<p>   tty.c, tty.h, tty_public.h:  tty driver from hw1, unchanged</p>
<p>iii) User-level files:</p>
<p>   tunistd.h: prototypes for user mode system calls(like UNIX /usr/include/unistd.h)</p>
<p>   uprog.c:  has main().  Easily extended to multiple user files, or user assembler sources, as long as they</p>
<pre><code>follow the syscall rules and have a _main entry point.  First example is

                   main() { write(TTY1,&quot;hi!n&quot;,4);}. 

 Work back to testio.c from hw1.
</code></pre><p>   ulib.s:  library set-ups for syscalls: _read, _write, _exit. Provided for write, you add read and exit.</p>
<p>   crt0.s:  user-level “C startup module”  sets up stack, calls _main, does exit syscall.  Entry point _ustart.</p>
<pre><code>Edit $pclibsrc/startup0.s
</code></pre><p>iv) hw1 solution files not directly used in hw2: </p>
<p>   io_public.h:  like tunistd.h above, but also lists ioinit(), and not exit().</p>
<p>   testio.c:  remove ioinit() call here to turn into proper user program.(and note that the kprintf’s are</p>
<pre><code>only for debugging)
</code></pre><p>v) Make file</p>
<p>makefile:  The provided makefile can make a hw2 system by “make U=test1” to use test1.c as a user</p>
<pre><code>program.  The default user program is uprog.c and it can be build by entering “make”.
</code></pre><p>In the hw2 directory, empty files (file with length =0) are provided and you can use them to test the makefile.  (Empty files are valid .c and .s programs and make treats them as regular files).  If you try</p>
<p>“make U=test1” with the provided files, you should see compiles followed by a load with an error as follows:</p>
<p>…</p>
<p>io.opc: In function `write’:</p>
<p>/home/eoneil/444/hw2/io.c:50: multiple definition of `write’</p>
<p>ulib.opc(.text+0x0): first defined here</p>
<p>….</p>
<p>This happens because both ulib.s and io.c define global symbols named “write”.  You need to change write to syswrite in io.c to fix this. We want to use “write” for the user-level system call, so the kernel</p>
<p>needs another name for its function.  syswrite is the Linux kernel name for its write-implementing function, so let’s adopt that name.</p>
<p>3) The Finished Program</p>
<p>The idea here is that each user program to be run on the SAPC has to be separately built with tunix, downloaded and run. Startup0 executes first, and transfers control to the kernel initialization in tunix.c, which sets up the system and starts the user code at ustart (calling ustart will do the trick).  The C user startup module reinitializes the stack and calls main.  The syscalls in the user code (in ulib.s, called from test1.c) cause execution of the system call handler in tunix.c (and functions called from there), returning to the user code in ulib.s at the iret. Finally the user does a syscall exit.  The kernel gets control, and finishes up.</p>
<p>4) Suggested Steps</p>
<p>There are lots of little pieces to this system.  Here is a suggested sequence to follow:</p>
<ol>
<li>Get a system built.  Change io.c’s write to syswrite, read to sysread, fill out startup0 and startup1, write a tiny tunix.c init function that calls ioinit, then calls main (cheating for now–later it should call ustart), and then returns to startup, shutting down.  At this point, test1.c just has a main that kprintf’s a message.  Now it should build and run, but does no syscalls.</li>
</ol>
<ol start="2">
<li>ulib.s is set up for write already, so do the write syscall first. Set the trap vector up in kernel init in tunix.c, and write sysentry.s—have it push registers on the stack and then call into tunix.c.  In tunix.c, access the pushed registers (themselves syscall arguments from the user) via args to the C function, and call syswrite.  Make test1.c do a simple write.  We’ll go over the trick about the syscall args in class.</li>
</ol>
<ol start="3">
<li>Next implement syscall exit and add an exit to test1.c.</li>
</ol>
<ol start="4">
<li>Write the proper user startup module crt0.s to reinitialize the stack and call into main, then when that returns, it does an exit syscall. It has entry point _ustart.  Change the call to main in kernel initialization</li>
</ol>
<p>to call ustart now.  Try a user program without its own exit syscall.</p>
<p>留学生作业代写,cs作业代写,cs代写,作业代写,北美cs作业代写,澳洲cs作业代写,加拿大cs作业代写,cs作业代写价格,靠谱cs作业代写,程序代写<br><img src="images/wechat.jpeg" alt="WeChat"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/c-c-代写-java代写-python代写-matlab代写-作业代写-留学生作业代写/" rel="tag"># c/c++代写,java代写,python代写,matlab代写,作业代写,留学生作业代写</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/04/Task000025/" rel="next" title="Programming Assignment 4">
                <i class="fa fa-chevron-left"></i> Programming Assignment 4
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/04/Task000027/" rel="prev" title="Principles of Database Systems">
                Principles of Database Systems <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/wechat.jpeg"
                alt="Nameless Coder" />
            
              <p class="site-author-name" itemprop="name">Nameless Coder</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">74</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nameless Coder</span>

  
</div>


  <div class="powered-by">由 <a rel="external nofollow" class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a rel="external nofollow" class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
